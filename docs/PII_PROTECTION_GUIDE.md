# 개인정보 자동 보호 가이드 🔒

VOC 자동화 시스템에서 개인정보를 안전하게 보호하는 방법을 설명합니다.

## 📋 목차

- [왜 개인정보 보호가 중요한가](#왜-개인정보-보호가-중요한가)
- [시스템 동작 방식](#시스템-동작-방식)
- [자동 보호 설정하기](#자동-보호-설정하기)
- [지원되는 개인정보 유형](#지원되는-개인정보-유형)
- [워크플로우 예제](#워크플로우-예제)
- [문제 해결](#문제-해결)

## 왜 개인정보 보호가 중요한가

### 🚨 위험 상황

**설정하지 않으면 이런 일이 발생합니다:**

```
사용자 입력:
"제 이메일 hong.gildong@company.com으로 연락주세요.
전화번호는 010-1234-5678이고 생년월일은 19721206입니다."

                    ↓ (개인정보 그대로!)

Cursor의 LLM:
- ❌ 이메일, 전화번호, 생년월일이 그대로 전송됨
- ❌ LLM 학습 데이터에 포함될 수 있음
- ❌ 로그에 기록될 수 있음
- ❌ GDPR, 개인정보보호법 위반 가능
```

### ✅ 안전한 상황 (자동 보호 설정 후)

```
사용자 입력:
"제 이메일 hong.gildong@company.com으로 연락주세요.
전화번호는 010-1234-5678이고 생년월일은 19721206입니다."

                    ↓ (자동 감지 & 비식별화!)

Cursor의 LLM이 보는 것:
"제 이메일 [EMAIL_001]으로 연락주세요.
전화번호는 [PHONE_001]이고 생년월일은 [BIRTHDATE_001]입니다."

✅ 개인정보 완전 보호!
✅ 원본은 안전한 메모리에만 저장 (1시간 후 자동 삭제)
✅ Jira 같은 안전한 저장소에만 복원
```

## 시스템 동작 방식

### 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│  사용자 입력 (개인정보 포함)                             │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│  Cursor + .cursorrules 파일                             │
│  "항상 먼저 개인정보를 비식별화하라"                     │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│  LLM이 자동으로 detectAndAnonymizePII 호출              │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│  PII Security Server                                    │
│  - 정규식으로 개인정보 감지                              │
│  - 플레이스홀더로 대체                                   │
│  - 매핑 정보 메모리 저장 (sessionId 기반)               │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│  익명화된 텍스트 ([EMAIL_001], [PHONE_001])            │
│  → 모든 분석/처리에 사용                                │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│  Jira 저장 시에만 원본 복원 (restoreOriginalText)      │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│  작업 완료 후 세션 삭제 (clearSession)                  │
│  → 메모리에서 완전 제거                                 │
└─────────────────────────────────────────────────────────┘
```

### 보안 체크포인트

| 단계           | 개인정보 상태 | 보안 조치                      |
| -------------- | ------------- | ------------------------------ |
| 1. 사용자 입력 | ❌ 원본       | -                              |
| 2. PII 감지    | ⚠️ 처리 중    | 메모리에만 매핑 저장           |
| 3. LLM 분석    | ✅ 익명화     | [EMAIL_001] 등 플레이스홀더    |
| 4. VOC 처리    | ✅ 익명화     | 모든 작업에 익명화 텍스트 사용 |
| 5. Jira 저장   | ⚠️ 원본 복원  | 안전한 저장소에만              |
| 6. 세션 정리   | ✅ 삭제       | 메모리에서 완전 제거           |

## 자동 보호 설정하기

### 1단계: .cursorrules 파일 복사

**프로젝트별 설정:**

```bash
# VOC 처리 프로젝트 디렉토리에서
cp /path/to/voc-automation-mcp-server/.cursorrules .cursorrules
```

**전역 설정 (권장):**

```bash
# 홈 디렉토리에 복사 (모든 Cursor 프로젝트에 적용)
cp /path/to/voc-automation-mcp-server/.cursorrules ~/.cursorrules
```

### 2단계: 파일 내용 확인

`.cursorrules` 파일에는 다음이 포함되어 있습니다:

```
# VOC 처리 시 개인정보 보호 규칙

## 🔒 개인정보 보호 필수 규칙

사용자가 다음과 같은 내용을 입력하면:
- 이메일 주소
- 전화번호
- 생년월일
- 주민등록번호
- 신용카드 번호

**즉시 detectAndAnonymizePII를 호출하여 비식별화하세요!**
```

### 3단계: Cursor 재시작

```bash
# Cursor 완전 종료 후 재시작
# macOS: Cmd + Q
# Windows/Linux: Ctrl + Q
```

### 4단계: 테스트

Cursor 채팅창에서:

```
다음 텍스트에 개인정보가 있나요?

"이메일: test@example.com, 전화: 010-1234-5678, 생년월일: 19900101"
```

**기대 결과:**

```
⚠️ 개인정보가 감지되었습니다. 보안을 위해 비식별화 처리합니다.

감지된 정보:
- 이메일: 1개 → [EMAIL_001]
- 전화번호: 1개 → [PHONE_001]
- 생년월일: 1개 → [BIRTHDATE_001]

익명화된 텍스트:
"이메일: [EMAIL_001], 전화: [PHONE_001], 생년월일: [BIRTHDATE_001]"

세션 ID: voc-20260108-001
```

## 지원되는 개인정보 유형

### 자동 감지 패턴

| 유형         | 패턴 예시                                       | 플레이스홀더      |
| ------------ | ----------------------------------------------- | ----------------- |
| **이메일**   | `test@example.com`                              | `[EMAIL_001]`     |
| **전화번호** | `010-1234-5678`<br/>`6344 9445`<br/>`6344-9445` | `[PHONE_001]`     |
| **생년월일** | `19721206` (YYYYMMDD)                           | `[BIRTHDATE_001]` |
| **주민번호** | `123456-1234567`<br/>`1234561234567`            | `[SSN_001]`       |
| **신용카드** | `1234-5678-9012-3456`<br/>`1234567890123456`    | `[CARD_001]`      |

### 정규식 패턴

```python
# 이메일
r"\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b"

# 전화번호 (한국)
r"(?:(?:\+82[-\s]?|0)?(?:10|11|16|17|18|19)[-\s]?\d{3,4}[-\s]?\d{4}|\d{4}[\s-]\d{4})"

# 생년월일 (YYYYMMDD)
r"\b(?:19|20)\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])\b"

# 주민번호
r"\b\d{6}[-\s]?[1-4]\d{6}\b"

# 신용카드
r"\b(?:\d{4}[-\s]?){3}\d{4}\b"
```

## 워크플로우 예제

### 완전한 VOC 처리 (개인정보 보호 포함)

```javascript
// Cursor 채팅창 입력:
"다음 VOC를 안전하게 처리해줘:

'로그인 문제가 있어요.
이메일: hong.gildong@company.com
전화: 010-1234-5678
생년월일: 19721206
에러 코드: AUTH_001'

단계:
1. 개인정보 비식별화 (세션: voc-20260108-bizring-001)
2. 익명화된 텍스트로 VOC 분석 프롬프트 생성
3. 분석 수행 (LLM은 익명화된 텍스트만 봄)
4. 에러 컨텍스트 조회
5. Jira 티켓 생성
6. 원본 복원하여 Jira 코멘트 추가
7. 세션 정리"
```

### Cursor의 자동 처리 과정

```typescript
// Step 1: 자동 PII 감지 (.cursorrules 덕분!)
detectAndAnonymizePII({
  text: '이메일: hong.gildong@company.com...',
  sessionId: 'voc-20260108-bizring-001',
});
// → anonymizedText: "이메일: [EMAIL_001], 전화: [PHONE_001], 생년월일: [BIRTHDATE_001]..."

// Step 2: 익명화된 텍스트로 분석 프롬프트 생성
generateVOCAnalysisPrompt({
  vocText: anonymizedText, // ✅ 개인정보 없음!
});

// Step 3: LLM 분석 (개인정보 노출 없음)
// Cursor의 LLM이 프롬프트 실행

// Step 4: 분석 결과 파싱
parseVOCAnalysis({ llmResponse: '...' });

// Step 5: 에러 컨텍스트
getErrorContext({ errorCode: 'AUTH_001' });

// Step 6: Jira 티켓 생성
createJiraIssue({
  summary: '로그인 문제 (AUTH_001)',
  description: '... [EMAIL_001] ...', // 익명화된 텍스트 사용
  priority: 'High',
});

// Step 7: Jira에만 원본 복원
restoreOriginalText({
  anonymizedText: '...',
  sessionId: 'voc-20260108-bizring-001',
});
// → originalText: "이메일: hong.gildong@company.com..."

addComment({
  issueKey: 'VOC-123',
  comment: originalText, // Jira는 안전한 저장소
});

// Step 8: 정리
clearSession({ sessionId: 'voc-20260108-bizring-001' });
// → 메모리에서 모든 매핑 삭제
```

## 문제 해결

### Q1: 개인정보가 자동으로 비식별화되지 않아요

**확인사항:**

1. `.cursorrules` 파일이 존재하는가?

   ```bash
   ls -la ~/.cursorrules  # 또는
   ls -la .cursorrules
   ```

2. Cursor를 재시작했는가?

   - macOS: `Cmd + Q` 후 재시작
   - Windows/Linux: 완전 종료 후 재시작

3. 파일 내용이 올바른가?
   ```bash
   cat ~/.cursorrules | grep "개인정보"
   ```

**해결:**

- 파일 없으면 다시 복사
- 내용 확인 후 Cursor 재시작

### Q2: "세션을 찾을 수 없습니다" 에러

**원인:**

- 세션 ID가 일치하지 않음
- 세션이 만료됨 (1시간 TTL)

**해결:**

```javascript
// 같은 sessionId를 사용해야 함
detectAndAnonymizePII({ sessionId: "voc-001", ... })
restoreOriginalText({ sessionId: "voc-001", ... })  // ✅ 같음

// 다르면 에러!
detectAndAnonymizePII({ sessionId: "voc-001", ... })
restoreOriginalText({ sessionId: "voc-002", ... })  // ❌ 다름
```

### Q3: LLM이 원본 텍스트를 보고 있는 것 같아요

**확인:**

1. `.cursorrules` 설정이 적용되었는지 확인
2. Cursor 로그 확인 (Help → Show Logs)
3. `detectAndAnonymizePII`가 호출되었는지 확인

**디버그 프롬프트:**

```
다음 텍스트를 처리할 때 어떤 도구를 사용했는지 보여줘:

"이메일: test@example.com"

사용한 도구 목록을 알려줘.
```

**기대 결과:**

```
사용한 도구:
1. detectAndAnonymizePII
   - sessionId: voc-...
   - detectedPII: [{ type: "email", ... }]
```

### Q4: 여러 개인정보가 감지되지 않아요

**지원되는 패턴 확인:**

```bash
# PII 감지 패턴 확인
cat servers/pii-security-server/src/pii-detector.ts | grep "patterns ="
```

**패턴 추가가 필요하면:**

1. `src/pii_security/detector.py` 수정
2. Cursor 재시작 (로컬 개발 시)
3. 또는 새 버전 배포 후 캐시 클리어: `uv cache clean`

## 보안 체크리스트

### 배포 전

- [ ] `.cursorrules` 파일이 프로젝트에 존재
- [ ] 팀원 모두에게 설정 안내
- [ ] 테스트: 이메일, 전화번호, 생년월일 감지 확인
- [ ] 민감 정보(키/토큰)가 Git에 포함되지 않음

### 운영 중

- [ ] 주기적으로 PII 감지 패턴 업데이트
- [ ] 세션 TTL 모니터링 (기본 1시간)
- [ ] Cursor 로그에서 개인정보 누출 확인
- [ ] Jira 티켓에만 원본 저장되는지 확인

### 사고 대응

**개인정보가 LLM에 노출된 경우:**

1. 즉시 해당 세션 ID로 `clearSession` 호출
2. Cursor 로그 확인 및 삭제
3. 관련 Jira 티켓 확인
4. 보안팀에 보고
5. `.cursorrules` 설정 재확인

## 추가 리소스

- [보안 문서](SECURITY.md)
- [API 명세서](API.md)
- [사용자 가이드](USER_GUIDE.md)
- [빠른 시작](QUICKSTART.md)

## 문의

- **보안 관련**: security@your-company.com
- **기술 지원**: it-support@your-company.com
- **Slack**: #voc-automation

---

**마지막 업데이트**: 2026-01-29  
**문서 버전**: 2.0 (Python/FastMCP)
